<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="748" height="852" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[title: WebSocket Chat Protocol
participant Client
participant Server
participant Redis
Note over Client,Redis: *Connection flow*
Client->Server: connect
Client->Server: send (type:'open')
Server->Redis: subscribe('channel/room:id-id')
Server->Redis: zrange('room:id-id', -100, -1)
Redis-->Server: messages
Server-->Client: recieve (type:'history')

Note over Client,Redis: *Send message flow*
Client->Server: send (type:'send')
Server->Redis: zadd('room:id-id', date, message)
Server->Redis: publish('channel/room:id-id', message)
Redis-->Server: send message from PubSub
Server-->Client: recieve (type:'message')

Note over Client,Redis: *Disconnection flow*
Client->Server: disconnect
Note right of Server: unsubscribe room channel
Server->Redis: unsubscribe('channel/room:id-id')
]]></source><desc>WebSocket Chat Protocol</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"><rect x="10" y="10" width="230.828125" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="15" y="30" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">WebSocket Chat Protocol</tspan></text></g><g class="actor"><rect x="10" y="48" width="77.609375" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="73" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">Client</tspan></text></g><g class="actor"><rect x="10" y="794.1875" width="77.609375" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="819.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">Client</tspan></text></g><line x1="48.8046875" x2="48.8046875" y1="86" y2="794.1875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="260.4375" y="48" width="77.609375" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="270.4375" y="73" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="270.4375">Server</tspan></text></g><g class="actor"><rect x="260.4375" y="794.1875" width="77.609375" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="270.4375" y="819.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="270.4375">Server</tspan></text></g><line x1="299.2421875" x2="299.2421875" y1="86" y2="794.1875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="650.1015625" y="48" width="68" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="660.1015625" y="73" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="660.1015625">Redis</tspan></text></g><g class="actor"><rect x="650.1015625" y="794.1875" width="68" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="660.1015625" y="819.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="660.1015625">Redis</tspan></text></g><line x1="684.1015625" x2="684.1015625" y1="86" y2="794.1875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="note"><rect x="38.8046875" y="106" width="655.296875" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="43.8046875" y="126" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="43.8046875">*Connection flow*</tspan></text></g><g class="signal"><text x="140.421875" y="165" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="140.421875">connect</tspan></text><line x1="48.8046875" x2="299.2421875" y1="172" y2="172" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="87.609375" y="202.890625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="87.609375">send (type:'open')</tspan></text><line x1="48.8046875" x2="299.2421875" y1="210.21875" y2="210.21875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="342.8515625" y="241.21875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="342.8515625">subscribe('channel/room:id-id')</tspan></text><line x1="299.2421875" x2="684.1015625" y1="248.21875" y2="248.21875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="347.6484375" y="279.109375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="347.6484375">zrange('room:id-id', -100, -1)</tspan></text><line x1="299.2421875" x2="684.1015625" y1="286.4375" y2="286.4375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="453.265625" y="317.328125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="453.265625">messages</tspan></text><line x1="684.1015625" x2="299.2421875" y1="324.65625" y2="324.65625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="58.8046875" y="355.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="58.8046875">recieve (type:'history')</tspan></text><line x1="299.2421875" x2="48.8046875" y1="362.875" y2="362.875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="38.8046875" y="382.875" width="655.296875" height="28.21875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="43.8046875" y="402.875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="43.8046875">*Send message flow*</tspan></text></g><g class="signal"><text x="87.609375" y="441.984375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="87.609375">send (type:'send')</tspan></text><line x1="48.8046875" x2="299.2421875" y1="449.3125" y2="449.3125" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="333.25" y="480.203125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="333.25">zadd('room:id-id', date, message)</tspan></text><line x1="299.2421875" x2="684.1015625" y1="487.53125" y2="487.53125" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="309.2421875" y="518.421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="309.2421875">publish('channel/room:id-id', message)</tspan></text><line x1="299.2421875" x2="684.1015625" y1="525.75" y2="525.75" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="376.453125" y="556.640625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="376.453125">send message from PubSub</tspan></text><line x1="684.1015625" x2="299.2421875" y1="563.96875" y2="563.96875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="58.8046875" y="594.859375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="58.8046875">recieve (type:'message')</tspan></text><line x1="299.2421875" x2="48.8046875" y1="602.1875" y2="602.1875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="38.8046875" y="622.1875" width="655.296875" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="43.8046875" y="642.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="43.8046875">*Disconnection flow*</tspan></text></g><g class="signal"><text x="126.015625" y="681.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="126.015625">disconnect</tspan></text><line x1="48.8046875" x2="299.2421875" y1="688.1875" y2="688.1875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="319.2421875" y="708.1875" width="240.4375" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="324.2421875" y="728.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="324.2421875">unsubscribe room channel</tspan></text></g><g class="signal"><text x="333.25" y="767.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="333.25">unsubscribe('channel/room:id-id')</tspan></text><line x1="299.2421875" x2="684.1015625" y1="774.1875" y2="774.1875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g></svg>